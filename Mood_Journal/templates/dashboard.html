<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Mood Journal</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Base styling */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f7fa;
            color: #333;
        }

        .card {
            max-width: 700px;
            margin: 2rem auto;
            background-color: #fff;
            padding: 2rem;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.08);
        }

        header h1 {
            margin: 0 0 1rem 0;
            font-size: 2rem;
            font-weight: 600;
            color: #2c3e50;
        }

        /* Navigation buttons */
        nav {
            margin-bottom: 1.5rem;
        }
        nav a {
            display: inline-block;
            margin: 0.3rem 0.3rem 0.3rem 0;
            padding: 0.6rem 1.2rem;
            background: #4a90e2;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: background 0.2s;
        }
        nav a:hover {
            background: #357ABD;
        }
        nav a.logout {
            background-color: #e74c3c;
        }
        nav a.logout:hover {
            background-color: #c0392b;
        }

        /* Section headings */
        h2 {
            font-size: 1.3rem;
            margin-top: 1.5rem;
            margin-bottom: 0.8rem;
            color: #34495e;
        }

        /* Mood history list */
        .mood-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .mood-list li {
            padding: 0.8rem;
            border-bottom: 1px solid #eee;
            font-size: 0.95rem;
            display: flex;
            justify-content: space-between;
        }
        .mood-list li span.mood {
            font-weight: bold;
            color: #4a90e2;
        }
        .mood-list li:last-child {
            border-bottom: none;
        }

        /* Reminders section */
        .reminder-box {
            background: #f0f8ff;
            border-left: 4px solid #4a90e2;
            padding: 1rem;
            border-radius: 8px;
            font-size: 0.95rem;
            color: #2c3e50;
        }

        /* Responsive */
        @media (max-width: 600px) {
            .card {
                margin: 1rem;
                padding: 1rem;
            }
            nav a {
                display: block;
                width: 100%;
                text-align: center;
                margin: 0.4rem 0;
            }
            .mood-list li {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
<div class="card">
    <header>
        <h1>ðŸ“Š Mood Dashboard</h1>
        <nav>
            <a href="{{ url_for('index') }}">âž• New Entry</a>
            <a href="{{ url_for('export_csv') }}">ðŸ“‚ Export CSV</a>
            <a href="{{ url_for('logout') }}" class="logout">ðŸšª Logout</a>
        </nav>
    </header>
    <!-- Put this where you want the chart (e.g., above the mood list) -->
<section>
  <h2>Mood Trend</h2>
  <canvas id="moodTrend" width="800" height="320"></canvas>
</section>

<!-- Place Chart.js CDN BEFORE your script -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
async function renderMoodTrend() {
  try {
    const res = await fetch("{{ url_for('entries_json') }}"); // Flask url_for points to /api/entries_json
    if (!res.ok) throw new Error("Failed to fetch entries");
    const json = await res.json();
    const rawLabels = json.labels || [];
    const values = json.values || [];

    // Friendly label format (short date)
    const labels = rawLabels.map(s => {
      try {
        const d = new Date(s);
        if (!isNaN(d)) return d.toLocaleDateString();
        // fallback: return original
        return s.split("T")[0] || s;
      } catch (e) {
        return s;
      }
    });

    const ctx = document.getElementById('moodTrend').getContext('2d');
    if (window.moodChart) {
      // update existing
      window.moodChart.data.labels = labels;
      window.moodChart.data.datasets[0].data = values;
      window.moodChart.update();
      return;
    }

    window.moodChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: labels,
        datasets: [{
          label: 'Mood (1â€“10)',
          data: values,
          borderColor: 'rgba(255,165,0,0.95)',   // light orange
          backgroundColor: 'rgba(255,165,0,0.12)',
          fill: true,
          tension: 0.3,
          pointRadius: 3
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            suggestedMin: 1,
            suggestedMax: 10,
            ticks: { stepSize: 1 }
          }
        },
        plugins: {
          legend: { display: false },
          tooltip: { mode: 'index', intersect: false }
        }
      }
    });
  } catch (err) {
    console.error("Could not render mood trend:", err);
  }
}

// Run on page load
window.addEventListener('DOMContentLoaded', () => {
  renderMoodTrend();
  // If you want auto-refresh after saving an entry, call renderMoodTrend() after redirect or via AJAX success.
});
</script>

    <section>
        <h2>Your Mood History</h2>
        {% if entries %}
        <ul class="mood-list">
            {% for entry in entries %}
            <li>
                <span>{{ entry['timestamp'] }}</span>
                <span class="mood">{{ entry['mood'] }}</span>
                <span>{{ entry['sentiment'] }}</span>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>No mood entries yet. Start by adding a new entry! âœ¨</p>
        {% endif %}
    </section>

    <section>
        <h2>Reminders</h2>
        <div class="reminder-box">
            âœ… Enable daily reminders in your settings to keep track of your mood consistently.
        </div>
    </section>
</div>
</body>
</html>
